# Tony Framework v2.0 - Modular Architecture Design

**Design Date**: 2025-06-28  
**Architecture Version**: 2.0 Modular  
**Backward Compatibility**: Full support for v1.0 monolithic  
**Status**: Implementation Ready  

## ðŸ—ï¸ Directory Structure

### User-Level Configuration (Non-Destructive)
```
~/.claude/
â”œâ”€â”€ CLAUDE.md                    # USER'S FILE - never overwritten
â”œâ”€â”€ tony/                        # Tony framework modules
â”‚   â”œâ”€â”€ TONY-CORE.md            # Core coordination logic
â”‚   â”œâ”€â”€ TONY-TRIGGERS.md        # Natural language triggers
â”‚   â”œâ”€â”€ TONY-SETUP.md           # Auto-deployment scripts
â”‚   â”œâ”€â”€ AGENT-BEST-PRACTICES.md # Agent coordination standards
â”‚   â”œâ”€â”€ DEVELOPMENT-GUIDELINES.md # Global development standards
â”‚   â”œâ”€â”€ metadata/
â”‚   â”‚   â”œâ”€â”€ VERSION             # Framework version tracking
â”‚   â”‚   â”œâ”€â”€ INSTALL-LOG.md      # Installation audit log
â”‚   â”‚   â””â”€â”€ USER-BACKUP.md      # Backup of original user CLAUDE.md
â”‚   â””â”€â”€ templates/              # Reusable templates
â”‚       â”œâ”€â”€ project-templates/  # Project-specific customizations
â”‚       â””â”€â”€ agent-templates/    # Agent instruction templates
```

### Project-Level Structure (Generated by Tony)
```
project-root/
â”œâ”€â”€ CLAUDE.md                   # Project-specific instructions
â”œâ”€â”€ .claude/
â”‚   â””â”€â”€ commands/
â”‚       â””â”€â”€ engage.md           # Session continuity
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ agent-management/       # Agent coordination files
â”‚   â””â”€â”€ project-management/     # Project planning files
â””â”€â”€ logs/
    â”œâ”€â”€ agent-tasks/           # Agent execution logs
    â””â”€â”€ coordination/          # Tony coordination logs
```

## ðŸ“¦ Component Architecture

### Component Hierarchy & Dependencies

```mermaid
graph TD
    A[User's CLAUDE.md] --> B[Tony Import Section]
    B --> C[TONY-CORE.md]
    C --> D[TONY-TRIGGERS.md]
    C --> E[TONY-SETUP.md]
    C --> F[AGENT-BEST-PRACTICES.md]
    C --> G[DEVELOPMENT-GUIDELINES.md]
    
    H[Regular Sessions] --> A
    I[Tony Sessions] --> C
    J[Agent Sessions] --> F
    K[Development Sessions] --> G
```

### 1. TONY-CORE.md (Central Hub)
**Purpose**: Core coordination logic and session management  
**Dependencies**: TONY-TRIGGERS.md, TONY-SETUP.md  
**Load Trigger**: Tony role detection  
**Content**: 
- Identity assignment and mission statement
- Session types and handoff protocols
- Context efficiency strategy
- Universal compatibility framework
- Component orchestration logic

### 2. TONY-TRIGGERS.md (Trigger Detection)
**Purpose**: Natural language trigger phrase detection  
**Dependencies**: None  
**Load Trigger**: All sessions (lightweight detection)  
**Content**:
- Trigger phrase definitions
- Case-insensitive matching patterns
- Auto-deployment sequence triggers
- Context switching logic

### 3. TONY-SETUP.md (Deployment Automation)
**Purpose**: Heavy auto-deployment scripts and infrastructure  
**Dependencies**: TONY-CORE.md  
**Load Trigger**: Tony deployment sequences only  
**Content**:
- Project type detection logic
- Infrastructure creation scripts
- Template deployment automation
- Validation and monitoring setup

### 4. AGENT-BEST-PRACTICES.md (Agent Standards)
**Purpose**: Agent coordination standards (Tony-independent)  
**Dependencies**: None (standalone usable)  
**Load Trigger**: Agent coordination sessions  
**Content**:
- Tool authorization requirements
- Research-driven development standards
- Performance and quality gates
- Session management protocols
- Emergency coordination procedures

### 5. DEVELOPMENT-GUIDELINES.md (Global Standards)
**Purpose**: Universal development practices (Tony-independent)  
**Dependencies**: None (standalone usable)  
**Load Trigger**: All development sessions  
**Content**:
- Task tracking and numbering systems
- Testing and verification requirements
- Documentation standards
- Code standards and style guides
- File organization and git practices

## ðŸ”„ Import Mechanism Design

### Context-Aware Loading Strategy

#### Phase 1: Trigger Detection (Lightweight)
```
Session Start â†’ Load TONY-TRIGGERS.md â†’ Detect Tony Role Request
```

#### Phase 2: Conditional Loading (Tony Sessions Only)
```
Tony Detected â†’ Load TONY-CORE.md â†’ Orchestrate Additional Components
```

#### Phase 3: Component Orchestration (As Needed)
```
TONY-CORE.md â†’ 
    â”œâ”€â”€ Auto-deployment needed â†’ Load TONY-SETUP.md
    â”œâ”€â”€ Agent coordination needed â†’ Load AGENT-BEST-PRACTICES.md
    â””â”€â”€ Development standards needed â†’ Load DEVELOPMENT-GUIDELINES.md
```

### User CLAUDE.md Integration

#### Option A: Import Section (Recommended)
```markdown
# [User's Existing Content - COMPLETELY PRESERVED]

## ðŸ¤– Tech Lead Tony Framework v2.0 Integration
<!-- AUTO-MANAGED: Framework Version 2.0.0 | Last Updated: 2025-06-28 -->

### Tony Module Loading (Context-Aware)
The Tony framework uses modular, context-aware loading:

**Trigger Detection**: ~/.claude/tony/TONY-TRIGGERS.md (always loaded)
**Core Coordination**: ~/.claude/tony/TONY-CORE.md (Tony sessions only)
**Auto-Deployment**: ~/.claude/tony/TONY-SETUP.md (deployment sequences only)
**Agent Standards**: ~/.claude/tony/AGENT-BEST-PRACTICES.md (agent sessions)
**Dev Guidelines**: ~/.claude/tony/DEVELOPMENT-GUIDELINES.md (development sessions)

### Session Types & Loading
- **Regular Sessions**: Lightweight trigger detection only
- **Tony Sessions**: Full coordination framework loaded
- **Agent Sessions**: Agent best practices + core framework
- **Development Sessions**: Guidelines + applicable standards

### Framework Benefits v2.0
- **Zero User Impact**: Your customizations are never overwritten
- **Context Efficiency**: Load only needed components per session
- **Independent Updates**: Framework updates preserve your content
- **Modular Control**: Enable/disable components as needed

<!-- END AUTO-MANAGED SECTION -->
```

#### Option B: External Reference (Alternative)
```markdown
# [User's Existing Content - COMPLETELY PRESERVED]

## ðŸ¤– Tech Lead Tony Framework
Framework configuration: ~/.claude/tony/TONY-CORE.md
Version: 2.0 Modular Architecture
```

## ðŸš€ Installation Workflows

### Workflow 1: New Installation (Clean Environment)
```bash
1. Detect ~/.claude/CLAUDE.md â†’ Does not exist
2. Create minimal user CLAUDE.md with Tony integration
3. Deploy modular Tony components to ~/.claude/tony/
4. Generate installation log and version tracking
5. Verify modular installation
```

### Workflow 2: Augmentation (Existing User CLAUDE.md)
```bash
1. Detect ~/.claude/CLAUDE.md â†’ Exists
2. Backup existing file to ~/.claude/tony/metadata/USER-BACKUP.md
3. Scan for existing Tony integration â†’ Remove if found
4. Append new modular integration section
5. Deploy modular Tony components
6. Verify preservation of user content
```

### Workflow 3: Migration (Existing Monolithic Tony)
```bash
1. Detect monolithic Tony installation
2. Extract user customizations (if any)
3. Backup current CLAUDE.md
4. Migrate to modular architecture
5. Preserve functionality and customizations
6. Verify migration success
```

## ðŸ”§ Installation Script Architecture

### Smart Detection Logic
```bash
# Installation type detection
if [ ! -f ~/.claude/CLAUDE.md ]; then
    INSTALL_TYPE="new"
elif grep -q "Tech Lead Tony Auto-Deployment" ~/.claude/CLAUDE.md; then
    if [ -d ~/.claude/tony ]; then
        INSTALL_TYPE="update_modular"
    else
        INSTALL_TYPE="migrate_monolithic"
    fi
else
    INSTALL_TYPE="augment_existing"
fi
```

### Non-Destructive Augmentation
```bash
# Preserve user content completely
backup_user_content() {
    if [ -f ~/.claude/CLAUDE.md ]; then
        cp ~/.claude/CLAUDE.md ~/.claude/tony/metadata/USER-BACKUP-$(date +%s).md
        log_action "User content backed up"
    fi
}

append_tony_integration() {
    cat >> ~/.claude/CLAUDE.md << 'EOF'

## ðŸ¤– Tech Lead Tony Framework v2.0 Integration
<!-- AUTO-MANAGED: Framework Version 2.0.0 -->
[modular integration content]
<!-- END AUTO-MANAGED SECTION -->
EOF
}
```

## ðŸ“Š Version Control & Updates

### Framework Versioning
- **Component Versions**: Each module has independent versioning
- **Architecture Version**: Overall framework version (2.0)
- **User Content Protection**: Guaranteed preservation across all updates

### Update Strategy
```bash
# Update only framework components
update_tony_modules() {
    # Update modular components in ~/.claude/tony/
    # Never touch user's main CLAUDE.md content
    # Update only the AUTO-MANAGED section if needed
}
```

### Rollback Capability
```bash
# Complete rollback to user's original state
rollback_installation() {
    # Restore from ~/.claude/tony/metadata/USER-BACKUP.md
    # Remove all Tony components
    # Restore original environment
}
```

## âœ… Quality Assurance

### Installation Validation
- âœ… User content preservation verification
- âœ… Modular component loading tests
- âœ… Backward compatibility validation
- âœ… Functional parity verification
- âœ… Performance impact assessment

### Migration Testing
- âœ… Monolithic â†’ Modular migration
- âœ… User customization preservation
- âœ… Tony functionality continuity
- âœ… Session handoff verification

## ðŸ“ˆ Benefits Summary

### For Users
- **Zero Risk**: No user content ever overwritten
- **Clean Separation**: Framework vs. user customizations
- **Easy Updates**: Framework updates without user impact
- **Flexible Control**: Enable/disable components as needed

### For Framework
- **Maintainable**: Clear component boundaries
- **Testable**: Independent component validation
- **Scalable**: Add new components without user impact
- **Efficient**: Context-aware loading reduces overhead

---

**Implementation Status**: Ready for component creation  
**Next Phase**: Create modular component files  
**Risk Level**: Zero (non-destructive design)  
**Compatibility**: Full backward support for v1.0